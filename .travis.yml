language: generic
cache: ccache
dist: trusty
sudo: required

addons:
    apt:
        packages:
            - ccache
            - clang-3.6
            - gcc-5
        sources:
            - llvm-toolchain-trusty-3.6
            - ubuntu-toolchain-r-test

matrix:
    include:
        - os: linux
          compiler: gcc-5
          env: COMPILER="g++-5"
        - os: linux
          compiler: clang-3.6
          env: COMPILER="clang++-3.6"
        - os: osx
          compiler: gcc-5
          env: COMPILER="g++-5"
        - os: osx
          compiler: clang-3.6
          env: COMPILER="clang++-3.6"

install:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
     wget https://cmake.org/files/v3.9/cmake-3.9.0-Linux-x86_64.tar.gz;
     sudo tar -xf cmake-3.9.0-Linux-x86_64.tar.gz -C /usr/local/ --strip-components=1;
  fi

cache:
  directories:
    - $HOME/.hunter

script:
- cmake -H. -B_builds -DBUILD_TESTS=ON -DCMAKE_INSTALL_PREFIX=install -DCMAKE_BUILD_TYPE=Debug
- cmake --build _builds
- cmake --build _builds --target test -- ARGS=--verbose
- cmake --build _builds --target install

after_success:
  - bash <(curl -s https://codecov.io/bash)
