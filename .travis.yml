language: generic
cache: ccache
dist: trusty

addons:
    apt:
        packages:
            - ccache
            - clang-3.6
            - gcc-5
        sources:
            - llvm-toolchain-trusty-3.6
            - ubuntu-toolchain-r-test

matrix:
    include:
        - os: linux
          compiler: gcc-5
          env: COMPILER="g++-5"
        - os: linux
          compiler: clang-3.6
          env: COMPILER="clang++-3.6"
        - os: osx
          compiler: gcc-5
          env: COMPILER="g++-5"
        - os: osx
          compiler: clang-3.6
          env: COMPILER="clang++-3.6"

install:
- wget https://cmake.org/files/v3.8/cmake-3.8.2.tar.gz
- tar xf cmake-3.8.2.tar.gz
- cd cmake-3.8.2
- ./configure
- make
- sudo make install

script:
- cmake -H. -B_builds -DBUILD_TESTS=ON -DCMAKE_INSTALL_PREFIX=install -DCMAKE_BUILD_TYPE=Debug
- cmake --build _builds
- cmake --build _builds --target test -- ARGS=--verbose
- cmake --build _builds --target install

after_success:
  - bash <(curl -s https://codecov.io/bash)
