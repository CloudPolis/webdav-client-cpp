language: generic
cache: ccache
dist: trusty

addons:
    apt:
        packages:
            - ccache
            - clang-3.6
            - gcc-5
        sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test

matrix:
    include:
        - os: linux
          compiler: gcc-5
          env: BUILD_FROM_SOURCES="yes" COMPILER="g++-5" BUILD_TESTS="TRUE"
        - os: linux
          compiler: clang-3.6
          env: BUILD_FROM_SOURCES="yes" COMPILER="clang++-3.6" BUILD_TESTS="TRUE"
        - os: osx
          compiler: gcc-5
          env: BUILD_FROM_SOURCES="yes" COMPILER="g++-5" BUILD_TESTS="TRUE" OPENSSL_ROOT_DIR="/usr/local/ssl"
        - os: osx
          compiler: clang-3.6
          env: BUILD_FROM_SOURCES="yes" COMPILER="clang++-3.6" BUILD_TESTS="TRUE" OPENSSL_ROOT_DIR="/usr/local/ssl"
        - os: linux
          compiler: gcc-5
          env: BUILD_FROM_SOURCES="no" COMPILER="g++-5" BUILD_TESTS="TRUE"
        - os: linux
          compiler: clang-3.6
          env: BUILD_FROM_SOURCES="no" COMPILER="clang++-3.6" BUILD_TESTS="TRUE"
        - os: osx
          compiler: gcc-5
          env: BUILD_FROM_SOURCES="no" COMPILER="clang++-3.6" BUILD_TESTS="TRUE" OPENSSL_ROOT_DIR="/usr/local/opt/openssl"
        - os: osx
          compiler: clang-3.6
          env: BUILD_FROM_SOURCES="no" COMPILER="g++-5" BUILD_TESTS="TRUE" OPENSSL_ROOT_DIR="/usr/local/opt/openssl"

script:
- if [ "$BUILD_FROM_SOURCES" == "yes" ]; then  
    wget https://github.com/openssl/openssl/archive/OpenSSL_1_0_2g.tar.gz -O OpenSSL_1_0_2g.tar.gz;
    tar -xf OpenSSL_1_0_2g.tar.gz && cd openssl-OpenSSL_1_0_2g;
    ./config;
    make && sudo make install;
    cd .. && rm -rf openssl-OpenSSL_1_0_2g && rm -f OpenSSL_1_0_2g.tar.gz;
    wget https://github.com/curl/curl/archive/curl-7_48_0.tar.gz -O curl-7_48_0.tar.gz;
    tar -xf curl-7_48_0.tar.gz && cd curl-curl-7_48_0 || exit;
    mkdir build && cd build && cmake ..;
    make && sudo make install;
    cd ../.. && rm -rf curl-curl-7_48_0 && rm -f curl-7_48_0.tar.gz;
    wget https://github.com/zeux/pugixml/releases/download/v1.7/pugixml-1.7.tar.gz -O pugixml-1.7.tar.gz;
    tar -xf pugixml-1.7.tar.gz && cd pugixml-1.7 || exit;
    mkdir build && cd build && cmake ../scripts/ -DBUILD_SHARED_LIBS:BOOL=TRUE;
    make && sudo make install;
    cd ../.. && rm -rf pugixml-1.7 && rm -f pugixml-1.7.tar.gz;
  else
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      sudo apt-get update;
      sudo apt-get install libssl-dev libcurl4-openssl-dev libpugixml-dev;
    else
      brew install openssl curl pugixml;
    fi;
  fi;
- mkdir build && cd build
- cmake .. -DBUILD_TESTS:BOOL=$BUILD_TESTS -DHOME_PUGIXML="/usr/local" && make
